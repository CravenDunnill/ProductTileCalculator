<?php
/**
 * CravenDunnill ProductTileCalculator Extension
 *
 * Warehouse Closure Notice for Cart Page
 *
 * @var $block \CravenDunnill\ProductTileCalculator\Block\WarehouseClosureNotice
 */

if (!$block->isEnabled() || !$block->getMessage()) {
    return;
}
?>

<style>
    .cart-warehouse-closure-notice {
        padding: 12px 15px;
        border-radius: 6px;
        margin-bottom: 15px;
        text-align: center;
        position: relative;
        overflow: hidden;
        font-weight: 200;
    }

    .cart-warehouse-closure-notice::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.3),
            transparent
        );
        animation: cart-warehouse-shimmer 3s infinite;
    }

    @keyframes cart-warehouse-shimmer {
        0% {
            left: -100%;
        }
        50%, 100% {
            left: 100%;
        }
    }

    .cart-warehouse-closure-notice .notice-content {
        position: relative;
        z-index: 1;
    }

    .cart-warehouse-closure-notice a {
        color: inherit;
        text-decoration: underline;
    }

    .cart-warehouse-closure-notice a:hover {
        text-decoration: none;
    }
</style>

<div id="cart-warehouse-closure-notice"
     class="cart-warehouse-closure-notice"
     style="display: none;"
     data-config="<?= $block->escapeHtmlAttr($block->getConfigJson()) ?>">
    <div class="notice-content"></div>
</div>

<script>
require(['jquery'], function($) {
    'use strict';

    $(document).ready(function() {
        var $notice = $('#cart-warehouse-closure-notice');
        var config = $notice.data('config');

        function isWithinSchedule(config) {
            var now = new Date();

            if (config.startDatetime) {
                var startDate = new Date(config.startDatetime);
                if (now < startDate) {
                    return false;
                }
            }

            if (config.endDatetime) {
                var endDate = new Date(config.endDatetime);
                if (now > endDate) {
                    return false;
                }
            }

            return true;
        }

        function updateNoticeVisibility() {
            if (!config || !config.enabled || !config.messageHtml) {
                $notice.hide();
                return;
            }

            if (isWithinSchedule(config)) {
                $notice.css({
                    'background-color': config.backgroundColor,
                    'color': config.textColor
                });

                $notice.find('.notice-content').html(config.messageHtml);
                $notice.show();
            } else {
                $notice.hide();
            }
        }

        updateNoticeVisibility();

        if (config && config.enabled && (config.startDatetime || config.endDatetime)) {
            setInterval(updateNoticeVisibility, 60000);
        }
    });
});
</script>
